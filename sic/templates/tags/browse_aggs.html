{% extends "base.html" %}
{% load humanize %}
{% load utils %}
{% block title %}browse aggregations - sic{% endblock %}
{% block style %}
    <style>
        .sparklines {
            position: absolute;
            margin-top: -2rem;
            transform: scaleX(150%) translateX(15%);
        }
        div.aggregations {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
            grid-gap: 20px;
            margin-top:0;
            width: var(--main-width);
        }

        div.aggregations article {
            display: grid;
            grid-template-rows: max-content max-content 1fr;
            grid-gap: 10px;
            border: 1px solid gray;
            border-radius: 3px;
            padding: 1rem 1.5rem;
        }
        div.aggregations article span.description {
            height: 6rem;
            overflow: auto;
            outline: 1px solid cadetblue;
            outline-offset: 5px;
        }
        div.aggregations article ul.tags {
            max-height: 4rem;
            overflow: auto;
            height: max-content;
        }
        div.aggregations>article>header{
            display: block;
            margin: 0;
        }
        div.aggregations>article .created {
            position: relative;
            bottom: -8px;
            font-size: 74%;
            text-align: center;
            width: 100%;
        }

        .aggregations a.agg-name {
            font-family: monospace;
            font-weight: bold;
            font-size: 110%;
        }
    </style>
{% endblock %}
{% block content %}
    <nav>
        <ul>
            <li><a href="{% url 'browse_tags' %}">Browse tags</a></li>
            <li><a href="{% url 'default_aggregations' %}">Browse default aggregations</a></li>
            <li><a href="{% url 'public_aggregations' %}">Browse public aggregations</a></li>
            {% if request.user.is_authenticated %}
                <li><a href="{% url 'new_aggregation' %}">Create aggregation</a></li>
            {% endif %}
            <li><form method="get" class="order-by-form">
                {% for f in order_by_form %}
                    {{ f.label_tag }}
                    {{ f }}
                {% endfor %}
                <input type="submit" value="sort">
            </form></li>
        </ul>
    </nav>
    {% if default %}
        <h1>Default aggregations</h1>
    {% else %}
        <h1>Public aggregations</h1>
    {% endif %}
    <p class="help-text">Aggregations are collections of tags you can subscribe to. They populate your frontpage. You can create your own private or public aggregations or subscribe to public ones.</p>
    {% spaceless %}
        <div class="aggregations">
            {% for agg in aggs %}
                <article>
                    <header><a href="{% url 'taggregation' agg.pk agg.slugify %}" class="agg-name">{{ agg.name }}</a> {{ agg.vertices|length }} tag{{ agg.vertices|pluralize}}</header>
                    <span>{{ agg.subscribers.count }} subscribers</span>
                    <span class="sparklines" title="activity for last 14 days">{{ agg.last_14_days }}</span>
                    <span class="description">{% if agg.description %}{{ agg.description }}{% else %}No description{% endif %}</span>
                    <ul class="tags">
                        {% for tag in agg.vertices %}
                            <li style="{% if show_colors %}{{ tag.color_vars_css }}{% endif %}"><div class="tag"><span class="tag-name"><a href="{{ tag.get_absolute_url }}">{{ tag.name }} {{ tag.stories.count }}</a></span></div></li>
                        {% endfor %}
                    </ul>
                    <span class="created">created {{ agg.created|naturaltime }}</span>
                </article>
            {% empty %}
                {% if default %}
                    <p>No default aggregations. <a href="{% url 'public_aggregations' %}">Browse public aggregations</a></p>
                {% else %}
                    <p>No public aggregations. {% if request.user.is_authenticated %}<a href="{% url 'new_aggregation' %}">Create your own</a>.{% endif %}</p>
                {% endif %}
            {% endfor %}
        </div>

    {% endspaceless %}
    <div class="pagination">
        <span class="step-links">
            {% if default %}
                {% if aggs.has_previous %}
                    <a href="{% url 'default_aggregations' %}">&laquo; first</a>
                    <a href="{% url 'default_aggregations_page' page_num=aggs.previous_page_number %}">&lt; previous</a>
                {% endif %}

                <span class="current">
                    Page {{ aggs.number }}
                </span>

                {% if aggs.has_next %}
                    <a href="{% url 'default_aggregations_page' page_num=aggs.next_page_number %}">next &gt;</a>
                {% else %}
                    (of {{aggs.number}})
                {% endif %}
            {% else %}
                {% if aggs.has_previous %}
                    <a href="{% url 'public_aggregations' %}">&laquo; first</a>
                    <a href="{% url 'public_aggregations_page' page_num=aggs.previous_page_number %}">&lt; previous</a>
                {% endif %}

                <span class="current">
                    Page {{ aggs.number }}
                </span>

                {% if aggs.has_next %}
                    <a href="{% url 'public_aggregations_page' page_num=aggs.next_page_number %}">next &gt;</a>
                {% else %}
                    (of {{aggs.number}})
                {% endif %}
            {% endif %}
        </span>
    </div>
{% endblock %}
